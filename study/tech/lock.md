---
hidden: true
---

# 우리 서비스는 Lock이 정말 필요한가? - 동시성 제어의 선택과 트레이드오프

> TL:DR&#x20;

주문 결제, 주문 취소 등 주문 서비스를 구현하면서 재고, 포인트, 쿠폰까지 여러 도메인의 정합성을 보장해야 했습니다. 동시성 문제를 해결하려면 Lock을 걸면 되지 않을까? 처음엔 그렇게 생각했습니다.

하지만 구현과 테스트를 반복하면서 계속 하나의 질문이 머릿속에 맴돌았습니다.

**"이 문제를 해결하는데, 이 방법이 정말 필요한가?"**

쿠폰에 비관적 락을 걸었더니 작동은 했지만 과한 것 같았고, 사용자 포인트 차감 과정에서는 데드락이 발생했으며, 좋아요 기능을 위한 상품 lock 비활성화. 세 가지 도메인에 대해서 세 가지 다른 선택. Lock을 절대반지처럼 사용하지 않고자 했습니다..

이 글에서는 동시성 제어를 위해 제가 고민했던 것들을 공유하고자 합니다.

* 쿠폰: 비관적 락에서 낙관적 락으로 전환한 이유
* 사용자 포인트: 데드락과의 싸움, 락 획득 순서 통일
* 좋아요: Lock 없이 원자적 UPDATE 쿼리로 해결
* 각 선택의 트레이드오프와 판단 기준

각 상황에 대해 이것이 맞다 라기 보다는, **어떤 기준으로 판단했는지 그 고민의 과정**을 담으려 했습니다. 결국 좋은 동시성 제어는 복잡한 락 기법을 많이 아는 게 아니라, 각 도메인의 특성과 요구사항을 명확히 이해하고 적절한 전략을 선택하는 것이라는 게 중요하다 생각합니다.
